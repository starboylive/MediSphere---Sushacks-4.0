<!DOCTYPE html>
<html lang="en">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Ai-Chatbot</title>
        <!-- <link rel="stylesheet" href="chatbot.css"> -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer"/>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,100..900&family=Pacifico&display=swap');

*{
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: "Inter",sans-serif;
}
body{
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background: linear-gradient(#EEEEFF,#C8C7FF);
}
.chatbot-popup{
    position: relative;
    width: 520px; /* default balanced width */
    background: #fff;
    overflow: hidden;
    border-radius: 22px;
    box-shadow: 0 0 160px 0 rgba(0,0,0,0.1),0 45px 90px -48px rgba(0,0,0,0.5);
}
.chat-header{
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: #140ed2;
    padding: 22px 40px; /* increased horizontal padding */
}
.chat-header .header-info{
    display: flex;
    align-items: center;
    gap: 20px; /* increased horizontal gap */
}
.header-info .chatbot-logo{
    width: 60px; /* larger */
    height: 60px; /* larger */
    background: #fff;
    border-radius: 40%;
    padding: 10px;
    fill: #3c36e7;
}
.header-info .logo-text{
    color: #fff;
    font-size: 1.8rem; /* slightly larger for wider layout */
    font-weight: bold;
}
.chat-header #close-chatbot{
    width: 50px; /* slightly larger */
    height: 45px; /* slightly larger */
    border: none;
    background: #140ed2;
    color: #fff;
    cursor: pointer;
    border-radius: 50%;
    transition: 0.3s ease;
}
.chat-header #close-chatbot:hover{
    background: #4640fd;
}
.chat-body{
    scrollbar-width:thin;
    scrollbar-color: #ccccf5 transparent;
    padding: 35px 40px; /* increased horizontal padding */
    gap: 28px; 
    display: flex;
    flex-direction: column;
    overflow-y:auto;
    height: 620px; /* same height */
    margin-bottom: 110px;
}
.chat-body .message{
    display: flex;
    align-items: center;
    gap: 16px; 
}
.chat-body .bot-message .bot-avatar{
    width: 55px;
    height: 55px;
    background: #3c36e7;
    border-radius: 50%;
    padding: 9px;
    fill: #fff;
    flex-shrink: 0;
    align-self: flex-end;
}
.chat-body .message .message-text{
    padding: 18px 22px;
    max-width: 100%;
    font-size: 1.05rem;
    background: #F2F2FF;
}
.chat-body .user-message{
    flex-direction: column;
    align-self:flex-end;
}
.chat-body .bot-message .message-text{
 background: #F2F2FF;
 border-radius: 18px 18px 5px 18px;
}
.chat-body .bot-message.thinking .message-text{
    padding:6px 22px;
}
.chat-body .user-message .message-text{
    color: #fff;
    background: #3c36e7;
    border-radius: 18px 18px 5px 18px;
    margin-left: 380px; /* increased for wider popup */
}
.chat-body .bot-message .thinking-indicator{
    display: flex;
    gap: 6px;
    padding-block: 22px;
}
.chat-body .bot-message .thinking-indicator .dot{
    height: 10px;
    width: 10px;
    opacity: 0.7;
    background: #4640fd;
    border-radius: 50%;
    animation:  dotPulse 1.8s ease-in-out infinite;
}
.chat-body .bot-message .thinking-indicator .dot:nth-child(1){
    animation-delay: 0.2s;
}
.chat-body .bot-message .thinking-indicator .dot:nth-child(2){
    animation-delay:0.3s;
}
.chat-body .bot-message .thinking-indicator .dot:nth-child(3){
    animation-delay: 0.4s;
}
@keyframes dotPulse{
    0%,44%{
        transform: translateY(0);
    }
    28%{
        opacity: 0.4;
        transform: translateY(-6px);
    }
    44%{
        opacity: 0.2;
    }
}
.chat-footer{
    position: absolute;
    bottom: 0;
    width: 100%;
    background:#fff;
    padding: 22px 40px 28px; /* increased horizontal padding */
}
.chat-footer .chat-form{
    position: relative;
    display: flex;
    align-items: center;
    background: #fff;
    outline: 1px solid #CCCCE5;
    border-radius: 42px;
}
.chat-footer .chat-form:focus-within{
    outline: 3px solid rgba(0,0,0,0.5);
}
.chat-form .message-input{
    border: none;
    outline: none;
    resize:none;
    font-size: 1.1rem;
    height: 60px;
    width: 100%;
    padding: 18px;
}
.chat-form .chat-controls{
    display: flex;
    height: 60px;
    align-items: center;
    align-self: flex-end;
    padding: 9px;
}
.chat-form .chat-controls #send-message{
 background: #4540ca;
 color: white;
 display: none;
}
.chat-form .message-input:valid~.chat-controls #send-message{
    display: block;
}
.chat-form .chat-controls #send-message:hover{
    background: #6864db;
}
.chat-form .chat-controls button{
    height: 50px;
    width: 50px;
    border: none;
    border-radius: 50%;
    color: #4540ca;
    background: none;
    transition: 0.3s ease;
    cursor: pointer;
}
.chat-form .chat-controls button:hover{
    background: #f1f1ff;
}
.chat-body .user-message .attach{
    width: 70%;
    margin-left: 380px; /* increased for wider popup */
    border-radius: 18px 5px 18px 18px;
    margin-top: -14px;
}
em-emoji-picker{
    position: absolute;
    left: 50%;
    top:-460px ;
    width: 100%;
    max-width: 500px; /* wider emoji picker */
    max-height: 420px;
    visibility: hidden;
    transform: translateX(-50%);
}
body.show-emoji-picker em-emoji-picker{
    visibility: visible;
}

    </style>
      </head>
    <body cz-shortcut-listen="true" class="show-emoji-picker">
        <div class="chatbot-popup">
            <div class="chat-header">
                <div class="header-info">
                    <svg class="chatbot-logo" xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 1024 1024">
                        <path d="M738.3 287.6H285.7c-59 0-106.8 47.8-106.8 106.8v303.1c0 59 47.8 106.8 106.8 106.8h81.5v111.1c0 .7.8 1.1 1.4.7l166.9-110.6 41.8-.8h117.4l43.6-.4c59 0 106.8-47.8 106.8-106.8V394.5c0-59-47.8-106.9-106.8-106.9zM351.7 448.2c0-29.5 23.9-53.5 53.5-53.5s53.5 23.9 53.5 53.5-23.9 53.5-53.5 53.5-53.5-23.9-53.5-53.5zm157.9 267.1c-67.8 0-123.8-47.5-132.3-109h264.6c-8.6 61.5-64.5 109-132.3 109zm110-213.7c-29.5 0-53.5-23.9-53.5-53.5s23.9-53.5 53.5-53.5 53.5 23.9 53.5 53.5-23.9 53.5-53.5 53.5zM867.2 644.5V453.1h26.5c19.4 0 35.1 15.7 35.1 35.1v121.1c0 19.4-15.7 35.1-35.1 35.1h-26.5zM95.2 609.4V488.2c0-19.4 15.7-35.1 35.1-35.1h26.5v191.3h-26.5c-19.4 0-35.1-15.7-35.1-35.1zM561.5 149.6c0 23.4-15.6 43.3-36.9 49.7v44.9h-30v-44.9c-21.4-6.5-36.9-26.3-36.9-49.7 0-28.6 23.3-51.9 51.9-51.9s51.9 23.3 51.9 51.9z"></path>
                    </svg>
                    <h2 class="logo-text">Medisphere Bot</h2>
                </div>
                <button id="close-chatbot" class="fa-solid fa-arrow-down"></button>
            </div>
            <div class="chat-body">
                <div class="message bot-message">
                    <svg class="bot-avatar" xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 1024 1024">
                        <path d="M738.3 287.6H285.7c-59 0-106.8 47.8-106.8 106.8v303.1c0 59 47.8 106.8 106.8 106.8h81.5v111.1c0 .7.8 1.1 1.4.7l166.9-110.6 41.8-.8h117.4l43.6-.4c59 0 106.8-47.8 106.8-106.8V394.5c0-59-47.8-106.9-106.8-106.9zM351.7 448.2c0-29.5 23.9-53.5 53.5-53.5s53.5 23.9 53.5 53.5-23.9 53.5-53.5 53.5-53.5-23.9-53.5-53.5zm157.9 267.1c-67.8 0-123.8-47.5-132.3-109h264.6c-8.6 61.5-64.5 109-132.3 109zm110-213.7c-29.5 0-53.5-23.9-53.5-53.5s23.9-53.5 53.5-53.5 53.5 23.9 53.5 53.5-23.9 53.5-53.5 53.5zM867.2 644.5V453.1h26.5c19.4 0 35.1 15.7 35.1 35.1v121.1c0 19.4-15.7 35.1-35.1 35.1h-26.5zM95.2 609.4V488.2c0-19.4 15.7-35.1 35.1-35.1h26.5v191.3h-26.5c-19.4 0-35.1-15.7-35.1-35.1zM561.5 149.6c0 23.4-15.6 43.3-36.9 49.7v44.9h-30v-44.9c-21.4-6.5-36.9-26.3-36.9-49.7 0-28.6 23.3-51.9 51.9-51.9s51.9 23.3 51.9 51.9z"></path>
                    </svg>
                    <div class="message-text">
                        Hey there ðŸ‘‹<br/>How Can I Help You Today?
                    </div>
                </div>
            </div>
            <div class="chat-footer">
                <form action="#" class="chat-form">
                    <textarea placeholder="Message..." class="message-input" required></textarea>
                    <div class="chat-controls">
                        <div class="file-upload-wrapper">
                            <input type="file" accept="images/*" id="file-input" hidden>
                            <button type="button" id="file-upload" class="fa-solid fa-paperclip"></button>
                        </div>
                        <button type="button" id="emoji-picker" class="fa-regular fa-face-smile"></button>
                        <button id="send-message" type="submit" class="fa-solid fa-arrow-up"></button>
                    </div>
                </form>
            </div>
        </div>
    </body>
    <script src="https://cdn.jsdelivr.net/npm/emoji-mart@latest/dist/browser.js"></script>
    <script>
      const messageInput = document.querySelector(".message-input");
const chatBody = document.querySelector(".chat-body");
const SendMessageBtn = document.querySelector("#send-message");
const fileInput = document.querySelector("#file-input");
const userData = {
    message: null,
    file:{
        data:null,
        mime_type:null,    }
};
const API_KEY = "AIzaSyAcPFb1Gni-kdgXkxCkRleYp2Gv1ZMb3UU";
const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${API_KEY}`;


const CreateElement = (content, ...classes) => {
    const div = document.createElement("div");
    div.classList.add("message", ...classes);
    div.innerHTML = content; 
    return div;
};
const generateBotMessage = async(IncomingMessage)=>{
    const messageElement = IncomingMessage.querySelector(".message-text");
    const requestActions = {
        method: "POST",
        headers:{ "Content-Type":"application/json"},
        body: JSON.stringify({
            contents:[{
               parts:[{ text:userData.message },  ...(userData.file.data ? [{inline_data:userData.file}]: [])]   
             }]
    })
};
  try{
    const response = await fetch(API_URL,requestActions);
    const data = await response.json();
    if(!response.ok) throw new Error(data.error.message);
    const botMessage = data.candidates[0].content.parts[0].text.trim();
     messageElement.textContent = botMessage;
  }
  catch(error){
    console.log(error);
  }
  finally{
    userData.file = {};
    chatBody.scrollTo({top: chatBody.scrollHeight, behavior:"smooth"});
  }
}



const HandleOutgoingMessage = (event) => {
    event.preventDefault();
    userData.message = messageInput.value.trim();
    if (!userData.message) return; 
    const MessageContent = `<div class="message-text"></div>${userData.file.data ? `<img src="data:${userData.file.mime_type};base64,${userData.file.data}"class="attach"/>` : ""}`
    const OutgoingMessage = CreateElement(MessageContent, "user-message");
    OutgoingMessage.querySelector(".message-text").textContent = userData.message;
    chatBody.appendChild(OutgoingMessage);
    chatBody.scrollTo({top: chatBody.scrollHeight, behavior:"smooth"});
    messageInput.value = ""; 
    

    
    setTimeout(() => {
        const BotMessageContent = `
            <svg class="bot-avatar" xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 1024 1024">
                <path d="M738.3 287.6H285.7c-59 0-106.8 47.8-106.8 106.8v303.1c0 59 47.8 106.8 106.8 106.8h81.5v111.1c0 .7.8 1.1 1.4.7l166.9-110.6 41.8-.8h117.4l43.6-.4c59 0 106.8-47.8 106.8-106.8V394.5c0-59-47.8-106.9-106.8-106.9zM351.7 448.2c0-29.5 23.9-53.5 53.5-53.5s53.5 23.9 53.5 53.5-23.9 53.5-53.5 53.5-53.5-23.9-53.5-53.5zm157.9 267.1c-67.8 0-123.8-47.5-132.3-109h264.6c-8.6 61.5-64.5 109-132.3 109zm110-213.7c-29.5 0-53.5-23.9-53.5-53.5s23.9-53.5 53.5-53.5 53.5 23.9 53.5 53.5-23.9 53.5-53.5 53.5zM867.2 644.5V453.1h26.5c19.4 0 35.1 15.7 35.1 35.1v121.1c0 19.4-15.7 35.1-35.1 35.1h-26.5zM95.2 609.4V488.2c0-19.4 15.7-35.1 35.1-35.1h26.5v191.3h-26.5c-19.4 0-35.1-15.7-35.1-35.1zM561.5 149.6c0 23.4-15.6 43.3-36.9 49.7v44.9h-30v-44.9c-21.4-6.5-36.9-26.3-36.9-49.7 0-28.6 23.3-51.9 51.9-51.9s51.9 23.3 51.9 51.9z"></path>
            </svg>
            <div class="message-text">
                <div class="thinking-indicator">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                </div>
            </div>`;
        const IncomingMessage = CreateElement(BotMessageContent, "bot-message");
        chatBody.appendChild(IncomingMessage);
        chatBody.scrollTo({top: chatBody.scrollHeight, behavior:"smooth"});
        generateBotMessage(IncomingMessage);
    }, 600);
};



messageInput.addEventListener("keydown", (event) => {
    const userMessage = event.target.value.trim();
    if (event.key === "Enter" && userMessage) {
        HandleOutgoingMessage(event);
    }
});
const picker = new EmojiMart.Picker({

    theme:"dark",
    skinTonePosition:"none",
    previewPosition:"none",
    onEmojiSelect: (emoji)=>{
        const { selectionStart: start, selectionEnd: end}= messageInput;
        messageInput.setRangeText(emoji.native,start,end,"end")
        messageInput.focus()
    },
    onClickOutside:(e)=>{
        
        if(e.target.id === "emoji-picker"){
          
            document.body.classList.toggle("show-emoji-picker") 
        }
        else{
      
            document.body.classList.remove("show-emoji-picker")
        }
          
    }
  
})
document.querySelector(".chat-controls").appendChild(picker)
          
          

fileInput.addEventListener("change",()=>{
    
    const file = fileInput.files[0];
    if(!file)return;
    const reader = new FileReader()
     reader.onload = (e)=>{
    const base64String = e.target.result.split(",")[1]
     userData.file = {
        data:base64String,
        mime_type:file.type
     }

       fileInput.value="";
     }
    reader.readAsDataURL(file)
    
})


SendMessageBtn.addEventListener("click", (event) => HandleOutgoingMessage(event));
document.querySelector("#file-upload").addEventListener("click",()=>fileInput.click())

    </script>
    <!-- <script src="chatbot.js"></script> -->
</html>
